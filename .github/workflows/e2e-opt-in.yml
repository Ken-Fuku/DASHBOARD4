name: E2E (opt-in)

# Manual / workflow_dispatch triggered E2E run for heavier integration tests
on:
  workflow_dispatch:
    inputs:
      use_secrets:
        description: 'Set to "true" to populate repository secrets into the environment for this run'
        required: false
        default: 'false'
  repository_dispatch:

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'

      - name: Build and run tests (no secrets)
        run: |
          cd app-core
          mvn -DskipTests=false test

  e2e-with-secrets:
    name: E2E (with secrets)
    if: github.event_name == 'workflow_dispatch' && (github.event.inputs.use_secrets == 'true')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'

      - name: Build and run tests (with secrets)
        env:
          UPLOAD_ENDPOINT: ${{ secrets.UPLOAD_ENDPOINT }}
          AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
        run: |
          cd app-core
          mvn -DskipTests=false test

# Notes:
# - This workflow is opt-in (manual trigger). To run E2E against a real environment that
#   talks to external services, set repository secrets and modify the steps to provide
#   necessary environment variables (e.g. UPLOAD_ENDPOINT, AUTH_TOKEN).
# - If you want scheduled nightly runs, add 'schedule' to the 'on' section.
